import { matchFilter } from './filter.ts';
function flatten(mw) {
    return typeof mw === 'function'
        ? mw
        : (ctx, next) => mw.middleware()(ctx, next);
}
function concat(first, andThen) {
    return async (ctx, next) => {
        let nextCalled = false;
        await first(ctx, async () => {
            if (nextCalled)
                throw new Error('`next` already called before!');
            else
                nextCalled = true;
            await andThen(ctx, next);
        });
    };
}
function pass(_ctx, next) {
    return next();
}
const leaf = () => Promise.resolve();
export async function run(middleware, ctx) {
    await middleware(ctx, leaf);
}
export class Composer {
    constructor(...middleware) {
        this.handler =
            middleware.length === 0
                ? pass
                : middleware.map(flatten).reduce(concat);
    }
    middleware() {
        return this.handler;
    }
    use(...middleware) {
        const composer = new Composer(...middleware);
        this.handler = concat(this.handler, flatten(composer));
        return composer;
    }
    on(filter, ...middleware) {
        return this.filter(matchFilter(filter), ...middleware);
    }
    hears(trigger, ...middleware) {
        const trg = triggerFn(trigger);
        return this.on([':text', ':caption']).filter(ctx => {
            const msg = ctx.message ?? ctx.channelPost;
            return match(ctx, msg.text ?? msg.caption, trg);
        }, ...middleware);
    }
    command(command, ...middleware) {
        const atCommands = new Set();
        const noAtCommands = new Set();
        toArray(command).forEach(cmd => {
            if (cmd.startsWith('/')) {
                throw new Error(`Do not include '/' when registering command handlers (use '${cmd.substr(0, 1)}' not '${cmd}')`);
            }
            const set = cmd.indexOf('@') === -1 ? noAtCommands : atCommands;
            set.add(cmd);
        });
        return this.on(':entities:bot_command').filter(ctx => {
            const msg = ctx.message ?? ctx.channelPost;
            const txt = msg.text ?? msg.caption;
            const entities = msg.entities ?? msg.caption_entities;
            return entities.some(e => {
                if (e.type !== 'bot_command')
                    return false;
                if (e.offset !== 0)
                    return false;
                const cmd = txt.substring(1, e.length);
                if (noAtCommands.has(cmd) || atCommands.has(cmd)) {
                    ctx.match = txt.substr(cmd.length + 1);
                    return true;
                }
                const index = cmd.indexOf('@');
                if (index === -1)
                    return false;
                if (noAtCommands.has(cmd.substring(0, index))) {
                    ctx.match = txt.substr(cmd.length + 1);
                    return true;
                }
                return false;
            });
        }, ...middleware);
    }
    callbackQuery(trigger, ...middleware) {
        const trg = triggerFn(trigger);
        return this.on('callback_query:data').filter(ctx => match(ctx, ctx.callbackQuery.data, trg), ...middleware);
    }
    gameQuery(trigger, ...middleware) {
        const trg = triggerFn(trigger);
        return this.on('callback_query:game_short_name').filter(ctx => match(ctx, ctx.callbackQuery.game_short_name, trg), ...middleware);
    }
    inlineQuery(trigger, ...middleware) {
        const trg = triggerFn(trigger);
        return this.on('inline_query').filter(ctx => match(ctx, ctx.inlineQuery.query, trg), ...middleware);
    }
    filter(predicate, ...middleware) {
        const composer = new Composer(...middleware);
        this.branch(predicate, composer, pass);
        return composer;
    }
    drop(predicate, ...middleware) {
        return this.filter((ctx) => !predicate(ctx), ...middleware);
    }
    fork(...middleware) {
        const composer = new Composer(...middleware);
        const fork = flatten(composer);
        this.use((ctx, next) => Promise.all([next(), run(fork, ctx)]));
        return composer;
    }
    lazy(middlewareFactory) {
        return this.use(async (ctx, next) => {
            const middleware = await middlewareFactory(ctx);
            const arr = toArray(middleware);
            await flatten(new Composer(...arr))(ctx, next);
        });
    }
    route(router, routeHandlers, fallback = pass) {
        return this.lazy(async (ctx) => {
            const route = await router(ctx);
            return route === undefined ? [] : routeHandlers[route] ?? fallback;
        });
    }
    branch(predicate, trueMiddleware, falseMiddleware) {
        return this.lazy(ctx => predicate(ctx) ? trueMiddleware : falseMiddleware);
    }
}
function triggerFn(trigger) {
    return toArray(trigger).map(t => typeof t === 'string'
        ? (txt) => (txt === t ? t : null)
        : (txt) => t.exec(txt));
}
function match(ctx, content, triggers) {
    for (const t of triggers) {
        const res = t(content);
        if (res) {
            ctx.match = res;
            return true;
        }
    }
    return false;
}
function toArray(e) {
    return Array.isArray(e) ? e : [e];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9zZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb21wb3Nlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQXVCLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQWlGOUQsU0FBUyxPQUFPLENBQW9CLEVBQWlCO0lBQ2pELE9BQU8sT0FBTyxFQUFFLEtBQUssVUFBVTtRQUMzQixDQUFDLENBQUMsRUFBRTtRQUNKLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDbkQsQ0FBQztBQUNELFNBQVMsTUFBTSxDQUNYLEtBQXNCLEVBQ3RCLE9BQXdCO0lBRXhCLE9BQU8sS0FBSyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUN2QixJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUE7UUFDdEIsTUFBTSxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hCLElBQUksVUFBVTtnQkFBRSxNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUE7O2dCQUMzRCxVQUFVLEdBQUcsSUFBSSxDQUFBO1lBQ3RCLE1BQU0sT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM1QixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUMsQ0FBQTtBQUNMLENBQUM7QUFDRCxTQUFTLElBQUksQ0FBb0IsSUFBTyxFQUFFLElBQWtCO0lBQ3hELE9BQU8sSUFBSSxFQUFFLENBQUE7QUFDakIsQ0FBQztBQUVELE1BQU0sSUFBSSxHQUFpQixHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7QUFPbEQsTUFBTSxDQUFDLEtBQUssVUFBVSxHQUFHLENBQ3JCLFVBQTJCLEVBQzNCLEdBQU07SUFFTixNQUFNLFVBQVUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFD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